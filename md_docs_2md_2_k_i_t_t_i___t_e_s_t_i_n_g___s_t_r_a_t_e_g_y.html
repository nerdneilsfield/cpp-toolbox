<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta name="generator" content="Doxygen 1.9.8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- BEGIN opengraph metadata -->
    <meta property="og:title" content="C++ Toolbox" />
    <meta
      property="og:image"
      content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452"
    />
    <meta
      property="og:description"
      content="A collection of tools for C++ development."
    />
    <meta
      property="og:url"
      content="https://github.com/nerdneilsfield/cpp-toolbox"
    />
    <!-- END opengraph metadata -->
    <!-- BEGIN twitter metadata -->
    <meta
      name="twitter:image:src"
      content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452"
    />
    <meta name="twitter:title" content="Doxygen Awesome" />
    <meta
      name="twitter:description"
      content="Custom CSS theme for doxygen html-documentation with lots of customization parameters."
    />
    <!-- END twitter metadata -->
    <title>cpp-toolbox: KITTI Dataset Loader 测试策略</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <link rel="icon" type="image/svg+xml" href="logo.drawio.svg" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <script
      type="text/javascript"
      src="doxygen-awesome-darkmode-toggle.js"
    ></script>
    <script
      type="text/javascript"
      src="doxygen-awesome-fragment-copy-button.js"
    ></script>
    <script
      type="text/javascript"
      src="doxygen-awesome-paragraph-link.js"
    ></script>
    <script
      type="text/javascript"
      src="doxygen-awesome-interactive-toc.js"
    ></script>
    <script
      type="text/javascript"
      src="doxygen-awesome-tabs.js"
    ></script>
    <script
      type="text/javascript"
      src="toggle-alternative-theme.js"
    ></script>
    <script type="text/javascript">
      DoxygenAwesomeFragmentCopyButton.init();
      DoxygenAwesomeDarkModeToggle.init();
      DoxygenAwesomeParagraphLink.init();
      DoxygenAwesomeInteractiveToc.init();
      DoxygenAwesomeTabs.init();
    </script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <!-- https://tholman.com/github-corners/ -->
    <a
      href="https://github.com/nerdneilsfield/cpp-toolbox"
      class="github-corner"
      title="View source on GitHub"
      target="_blank"
      rel="noopener noreferrer"
    >
      <svg
        viewBox="0 0 250 250"
        width="40"
        height="40"
        style="position: absolute; top: 0; border: 0; right: 0; z-index: 99"
        aria-hidden="true"
      >
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor"
          style="transform-origin: 130px 106px"
          class="octo-arm"
        ></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor"
          class="octo-body"
        ></path></svg></a
    ><style>
      .github-corner:hover .octo-arm {
        animation: octocat-wave 560ms ease-in-out;
      }
      @keyframes octocat-wave {
        0%,
        100% {
          transform: rotate(0);
        }
        20%,
        60% {
          transform: rotate(-25deg);
        }
        40%,
        80% {
          transform: rotate(10deg);
        }
      }
      @media (max-width: 500px) {
        .github-corner:hover .octo-arm {
          animation: none;
        }
        .github-corner .octo-arm {
          animation: octocat-wave 560ms ease-in-out;
        }
      }
    </style>
    <div id="top">
      <!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr style="height: 56px">
              <td id="projectalign" style="padding-left: 0.5em">
                <div id="projectname">
                  cpp-toolbox
                  &#160;<span id="projectnumber"
                    >0.0.1</span
                  >
                </div>
                <div id="projectbrief">A toolbox library for C++</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
    </div>
  </body>
</html>
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2md_2_k_i_t_t_i___t_e_s_t_i_n_g___s_t_r_a_t_e_g_y.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">KITTI Dataset Loader 测试策略</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md166"></a> </p>
<h1><a class="anchor" id="autotoc_md167"></a>
1. 测试挑战</h1>
<ul>
<li>KITTI数据集体积庞大（单个序列可能几GB）</li>
<li>不能在代码仓库中包含真实数据</li>
<li>需要测试各种边界情况和错误处理</li>
<li>需要验证数据格式的正确性</li>
</ul>
<h1><a class="anchor" id="autotoc_md168"></a>
2. 测试策略概述</h1>
<h2><a class="anchor" id="autotoc_md169"></a>
2.1 三层测试架构</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────┐</div>
<div class="line">│      集成测试（可选，真实数据）        │</div>
<div class="line">├─────────────────────────────────────┤</div>
<div class="line">│      功能测试（小型模拟数据）          │</div>
<div class="line">├─────────────────────────────────────┤</div>
<div class="line">│      单元测试（Mock数据）             │</div>
<div class="line">└─────────────────────────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md170"></a>
3. 具体测试方案</h1>
<h2><a class="anchor" id="autotoc_md171"></a>
3.1 Mock数据生成器</h2>
<p>创建一个测试辅助类，生成最小化的合法KITTI格式数据：</p>
<div class="fragment"><div class="line"><span class="comment">// test/pcl/kitti_test_utils.hpp</span></div>
<div class="line"><span class="keyword">namespace </span>kitti_test_utils {</div>
<div class="line">    </div>
<div class="line"><span class="comment">// 创建临时测试目录结构</span></div>
<div class="line"><span class="keyword">class </span>kitti_test_env_t {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::filesystem::path temp_dir_;</div>
<div class="line">    std::string sequence_name_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    kitti_test_env_t(<span class="keyword">const</span> std::string&amp; sequence_name = <span class="stringliteral">&quot;00&quot;</span>);</div>
<div class="line">    ~kitti_test_env_t();  <span class="comment">// 自动清理</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 获取路径</span></div>
<div class="line">    std::string get_sequence_path() <span class="keyword">const</span>;</div>
<div class="line">    std::string get_velodyne_path() <span class="keyword">const</span>;</div>
<div class="line">    std::string get_labels_path() <span class="keyword">const</span>;</div>
<div class="line">    std::string get_poses_file() <span class="keyword">const</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 创建测试数据</span></div>
<div class="line">    <span class="keywordtype">void</span> create_test_point_cloud(std::size_t frame_idx, </div>
<div class="line">                                std::size_t num_points = 100);</div>
<div class="line">    <span class="keywordtype">void</span> create_test_labels(std::size_t frame_idx, </div>
<div class="line">                           std::size_t num_points = 100);</div>
<div class="line">    <span class="keywordtype">void</span> create_test_poses(std::size_t num_frames);</div>
<div class="line">    <span class="keywordtype">void</span> create_test_calibration();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 生成测试点云数据</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> DataType&gt;</div>
<div class="line"><span class="keywordtype">void</span> generate_test_point_cloud(<span class="keyword">const</span> std::string&amp; file_path,</div>
<div class="line">                              std::size_t num_points,</div>
<div class="line">                              <span class="keywordtype">bool</span> with_pattern = <span class="keyword">true</span>) {</div>
<div class="line">    std::ofstream file(file_path, std::ios::binary);</div>
<div class="line">    </div>
<div class="line">    std::random_device rd;</div>
<div class="line">    std::mt19937 gen(42);  <span class="comment">// 固定种子for可重复性</span></div>
<div class="line">    std::uniform_real_distribution&lt;DataType&gt; dist(-10.0, 10.0);</div>
<div class="line">    std::uniform_real_distribution&lt;DataType&gt; intensity_dist(0.0, 1.0);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; num_points; ++i) {</div>
<div class="line">        DataType x, y, z, intensity;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (with_pattern) {</div>
<div class="line">            <span class="comment">// 创建可识别的模式（如平面、球面等）</span></div>
<div class="line">            DataType angle = 2 * M_PI * i / num_points;</div>
<div class="line">            x = 5.0 * std::cos(angle);</div>
<div class="line">            y = 5.0 * std::sin(angle);</div>
<div class="line">            z = 0.1 * i;</div>
<div class="line">            intensity = <span class="keyword">static_cast&lt;</span>DataType<span class="keyword">&gt;</span>(i) / num_points;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            x = dist(gen);</div>
<div class="line">            y = dist(gen);</div>
<div class="line">            z = dist(gen);</div>
<div class="line">            intensity = intensity_dist(gen);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(&amp;x), <span class="keyword">sizeof</span>(DataType));</div>
<div class="line">        file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(&amp;y), <span class="keyword">sizeof</span>(DataType));</div>
<div class="line">        file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(&amp;z), <span class="keyword">sizeof</span>(DataType));</div>
<div class="line">        file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(&amp;intensity), <span class="keyword">sizeof</span>(DataType));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 生成测试标签数据</span></div>
<div class="line"><span class="keywordtype">void</span> generate_test_labels(<span class="keyword">const</span> std::string&amp; file_path,</div>
<div class="line">                         std::size_t num_points,</div>
<div class="line">                         <span class="keyword">const</span> std::vector&lt;uint32_t&gt;&amp; label_ids = {40, 44, 48, 49, 50, 70});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 生成测试位姿数据</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> DataType&gt;</div>
<div class="line"><span class="keywordtype">void</span> generate_test_poses(<span class="keyword">const</span> std::string&amp; file_path,</div>
<div class="line">                        std::size_t num_frames,</div>
<div class="line">                        <span class="keywordtype">bool</span> with_motion = <span class="keyword">true</span>) {</div>
<div class="line">    std::ofstream file(file_path);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; num_frames; ++i) {</div>
<div class="line">        Eigen::Matrix&lt;DataType, 4, 4&gt; pose = Eigen::Matrix&lt;DataType, 4, 4&gt;::Identity();</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (with_motion) {</div>
<div class="line">            <span class="comment">// 模拟简单的前进运动</span></div>
<div class="line">            pose(0, 3) = 0.1 * i;  <span class="comment">// x方向前进</span></div>
<div class="line">            pose(1, 3) = 0.05 * std::sin(0.1 * i);  <span class="comment">// 轻微横向移动</span></div>
<div class="line">            </div>
<div class="line">            <span class="comment">// 添加小幅旋转</span></div>
<div class="line">            DataType angle = 0.01 * i;</div>
<div class="line">            pose(0, 0) = std::cos(angle);</div>
<div class="line">            pose(0, 1) = -std::sin(angle);</div>
<div class="line">            pose(1, 0) = std::sin(angle);</div>
<div class="line">            pose(1, 1) = std::cos(angle);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 写入KITTI格式（前3行，每行4个值）</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; 3; ++row) {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; 4; ++col) {</div>
<div class="line">                <span class="keywordflow">if</span> (row &gt; 0 || col &gt; 0) file &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">                file &lt;&lt; std::fixed &lt;&lt; std::setprecision(9) &lt;&lt; pose(row, col);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        file &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 验证辅助函数</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> DataType&gt;</div>
<div class="line"><span class="keywordtype">bool</span> verify_point_cloud_format(<span class="keyword">const</span> std::string&amp; file_path, </div>
<div class="line">                              std::size_t expected_points);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> verify_label_format(<span class="keyword">const</span> std::string&amp; file_path, </div>
<div class="line">                        std::size_t expected_points);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> DataType&gt;</div>
<div class="line"><span class="keywordtype">bool</span> verify_pose_format(<span class="keyword">const</span> std::string&amp; file_path, </div>
<div class="line">                       std::size_t expected_frames);</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kitti_test_utils</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md172"></a>
3.2 单元测试示例</h2>
<div class="fragment"><div class="line"><span class="comment">// test/pcl/kitti_dataset_test.cpp</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kitti__odometry__dataset_8hpp.html">cpp-toolbox/io/dataloader/kitti_odometry_dataset.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;kitti_test_utils.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacetoolbox_1_1io.html">toolbox::io</a>;</div>
<div class="line"><span class="keyword">using namespace </span>kitti_test_utils;</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;KITTI Odometry Dataset Basic Tests&quot;</span>, <span class="stringliteral">&quot;[kitti][dataset]&quot;</span>) {</div>
<div class="line">    <span class="comment">// 创建临时测试环境</span></div>
<div class="line">    kitti_test_env_t test_env(<span class="stringliteral">&quot;test_seq&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;空数据集测试&quot;</span>) {</div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">        REQUIRE(dataset.size() == 0);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;单帧数据测试&quot;</span>) {</div>
<div class="line">        <span class="comment">// 创建一帧测试数据</span></div>
<div class="line">        test_env.create_test_point_cloud(0, 1000);</div>
<div class="line">        test_env.create_test_poses(1);</div>
<div class="line">        </div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">        REQUIRE(dataset.size() == 1);</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">auto</span> frame = dataset[0];</div>
<div class="line">        REQUIRE(frame.has_value());</div>
<div class="line">        REQUIRE(frame-&gt;cloud-&gt;size() == 1000);</div>
<div class="line">        REQUIRE(frame-&gt;frame_index == 0);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 验证位姿</span></div>
<div class="line">        <span class="keyword">auto</span> expected_pose = Eigen::Matrix4f::Identity();</div>
<div class="line">        REQUIRE(frame-&gt;pose.isApprox(expected_pose, 1e-6f));</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;多帧数据测试&quot;</span>) {</div>
<div class="line">        <span class="keyword">const</span> std::size_t num_frames = 10;</div>
<div class="line">        <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; num_frames; ++i) {</div>
<div class="line">            test_env.create_test_point_cloud(i, 500 + i * 100);</div>
<div class="line">        }</div>
<div class="line">        test_env.create_test_poses(num_frames);</div>
<div class="line">        </div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">        REQUIRE(dataset.size() == num_frames);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 测试随机访问</span></div>
<div class="line">        <span class="keyword">auto</span> frame5 = dataset[5];</div>
<div class="line">        REQUIRE(frame5.has_value());</div>
<div class="line">        REQUIRE(frame5-&gt;cloud-&gt;size() == 500 + 5 * 100);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 测试迭代器</span></div>
<div class="line">        std::size_t count = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; frame : dataset) {</div>
<div class="line">            REQUIRE(frame.cloud != <span class="keyword">nullptr</span>);</div>
<div class="line">            count++;</div>
<div class="line">        }</div>
<div class="line">        REQUIRE(count == num_frames);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;缓存测试&quot;</span>) {</div>
<div class="line">        test_env.create_test_point_cloud(0, 1000);</div>
<div class="line">        test_env.create_test_poses(1);</div>
<div class="line">        </div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">        dataset.set_cache_size(1);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 第一次访问</span></div>
<div class="line">        <span class="keyword">auto</span> frame1 = dataset[0];</div>
<div class="line">        <span class="keyword">auto</span> ptr1 = frame1-&gt;cloud.get();</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 第二次访问（应该从缓存返回）</span></div>
<div class="line">        <span class="keyword">auto</span> frame2 = dataset[0];</div>
<div class="line">        <span class="keyword">auto</span> ptr2 = frame2-&gt;cloud.get();</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 由于缓存，指针应该不同（因为返回的是副本）</span></div>
<div class="line">        REQUIRE(frame1-&gt;cloud-&gt;size() == frame2-&gt;cloud-&gt;size());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;KITTI Frame Pair Dataset Tests&quot;</span>, <span class="stringliteral">&quot;[kitti][dataset][pair]&quot;</span>) {</div>
<div class="line">    kitti_test_env_t test_env(<span class="stringliteral">&quot;test_seq&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;基本点云对测试&quot;</span>) {</div>
<div class="line">        <span class="keyword">const</span> std::size_t num_frames = 10;</div>
<div class="line">        <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; num_frames; ++i) {</div>
<div class="line">            test_env.create_test_point_cloud(i, 1000);</div>
<div class="line">        }</div>
<div class="line">        test_env.create_test_poses(num_frames);</div>
<div class="line">        </div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__pair__dataset__t.html">kitti_odometry_pair_dataset_t&lt;float&gt;</a> pair_dataset(</div>
<div class="line">            test_env.get_sequence_path(), 1);</div>
<div class="line">        </div>
<div class="line">        REQUIRE(pair_dataset.size() == num_frames - 1);</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">auto</span> pair = pair_dataset[0];</div>
<div class="line">        REQUIRE(pair.has_value());</div>
<div class="line">        REQUIRE(pair-&gt;source_index == 0);</div>
<div class="line">        REQUIRE(pair-&gt;target_index == 1);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 验证相对变换</span></div>
<div class="line">        <span class="keyword">auto</span> expected_transform = pair-&gt;target_pose * pair-&gt;source_pose.inverse();</div>
<div class="line">        REQUIRE(pair-&gt;relative_transform.isApprox(expected_transform, 1e-6f));</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;Skip参数测试&quot;</span>) {</div>
<div class="line">        <span class="keyword">const</span> std::size_t num_frames = 20;</div>
<div class="line">        <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; num_frames; ++i) {</div>
<div class="line">            test_env.create_test_point_cloud(i, 500);</div>
<div class="line">        }</div>
<div class="line">        test_env.create_test_poses(num_frames);</div>
<div class="line">        </div>
<div class="line">        std::size_t skip = 5;</div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__pair__dataset__t.html">kitti_odometry_pair_dataset_t&lt;float&gt;</a> pair_dataset(</div>
<div class="line">            test_env.get_sequence_path(), skip);</div>
<div class="line">        </div>
<div class="line">        REQUIRE(pair_dataset.size() == num_frames - skip);</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">auto</span> first_pair = pair_dataset[0];</div>
<div class="line">        REQUIRE(first_pair-&gt;source_index == 0);</div>
<div class="line">        REQUIRE(first_pair-&gt;target_index == skip);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Semantic KITTI Dataset Tests&quot;</span>, <span class="stringliteral">&quot;[kitti][dataset][semantic]&quot;</span>) {</div>
<div class="line">    kitti_test_env_t test_env(<span class="stringliteral">&quot;test_seq&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;带标签的数据测试&quot;</span>) {</div>
<div class="line">        <span class="keyword">const</span> std::size_t num_points = 1000;</div>
<div class="line">        test_env.create_test_point_cloud(0, num_points);</div>
<div class="line">        test_env.create_test_labels(0, num_points);</div>
<div class="line">        test_env.create_test_poses(1);</div>
<div class="line">        </div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1semantic__kitti__dataset__t.html">semantic_kitti_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">        REQUIRE(dataset.size() == 1);</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">auto</span> frame = dataset[0];</div>
<div class="line">        REQUIRE(frame.has_value());</div>
<div class="line">        REQUIRE(frame-&gt;cloud-&gt;size() == num_points);</div>
<div class="line">        REQUIRE(frame-&gt;labels.size() == num_points);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;标签过滤测试&quot;</span>) {</div>
<div class="line">        <span class="keyword">const</span> std::size_t num_points = 1000;</div>
<div class="line">        test_env.create_test_point_cloud(0, num_points);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 创建具有特定模式的标签</span></div>
<div class="line">        std::vector&lt;uint32_t&gt; labels;</div>
<div class="line">        <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; num_points; ++i) {</div>
<div class="line">            labels.push_back(i % 2 == 0 ? 40 : 44);  <span class="comment">// 一半道路，一半停车场</span></div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// 这里需要自定义标签写入...</span></div>
<div class="line">        </div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1semantic__kitti__dataset__t.html">semantic_kitti_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">        <span class="keyword">auto</span> frame = dataset[0];</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 提取道路点</span></div>
<div class="line">        <span class="keyword">auto</span> road_cloud = frame-&gt;get_labeled_cloud(40);</div>
<div class="line">        REQUIRE(road_cloud-&gt;size() == num_points / 2);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Error Handling Tests&quot;</span>, <span class="stringliteral">&quot;[kitti][dataset][error]&quot;</span>) {</div>
<div class="line">    SECTION(<span class="stringliteral">&quot;不存在的路径&quot;</span>) {</div>
<div class="line">        REQUIRE_THROWS_AS(</div>
<div class="line">            <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a>(<span class="stringliteral">&quot;/non/existent/path&quot;</span>),</div>
<div class="line">            <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__file__not__found.html">kitti_file_not_found</a></div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;损坏的点云文件&quot;</span>) {</div>
<div class="line">        kitti_test_env_t test_env(<span class="stringliteral">&quot;test_seq&quot;</span>);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 创建一个损坏的文件（大小不对）</span></div>
<div class="line">        std::string cloud_file = test_env.get_velodyne_path() + <span class="stringliteral">&quot;/000000.bin&quot;</span>;</div>
<div class="line">        std::ofstream file(cloud_file, std::ios::binary);</div>
<div class="line">        file &lt;&lt; <span class="stringliteral">&quot;corrupted&quot;</span>;</div>
<div class="line">        file.close();</div>
<div class="line">        </div>
<div class="line">        test_env.create_test_poses(1);</div>
<div class="line">        </div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">        <span class="keyword">auto</span> frame = dataset[0];</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 应该返回空或抛出异常</span></div>
<div class="line">        REQUIRE((!frame.has_value() || frame-&gt;cloud-&gt;size() == 0));</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;位姿文件格式错误&quot;</span>) {</div>
<div class="line">        kitti_test_env_t test_env(<span class="stringliteral">&quot;test_seq&quot;</span>);</div>
<div class="line">        test_env.create_test_point_cloud(0, 100);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 创建格式错误的位姿文件</span></div>
<div class="line">        std::ofstream pose_file(test_env.get_poses_file());</div>
<div class="line">        pose_file &lt;&lt; <span class="stringliteral">&quot;invalid pose format\n&quot;</span>;</div>
<div class="line">        pose_file.close();</div>
<div class="line">        </div>
<div class="line">        REQUIRE_THROWS_AS(</div>
<div class="line">            <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a>(test_env.get_sequence_path()),</div>
<div class="line">            <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__invalid__format.html">kitti_invalid_format</a></div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclasstoolbox_1_1io_1_1kitti__file__not__found_html"><div class="ttname"><a href="classtoolbox_1_1io_1_1kitti__file__not__found.html">toolbox::io::kitti_file_not_found</a></div><div class="ttdoc">Exception thrown when a file is not found.</div><div class="ttdef"><b>Definition</b> kitti_exceptions.hpp:19</div></div>
<div class="ttc" id="aclasstoolbox_1_1io_1_1kitti__invalid__format_html"><div class="ttname"><a href="classtoolbox_1_1io_1_1kitti__invalid__format.html">toolbox::io::kitti_invalid_format</a></div><div class="ttdoc">Exception thrown when file format is invalid.</div><div class="ttdef"><b>Definition</b> kitti_exceptions.hpp:33</div></div>
<div class="ttc" id="aclasstoolbox_1_1io_1_1kitti__odometry__dataset__t_html"><div class="ttname"><a href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">toolbox::io::kitti_odometry_dataset_t</a></div><div class="ttdoc">KITTI Odometry dataset loader.</div><div class="ttdef"><b>Definition</b> kitti_odometry_dataset.hpp:45</div></div>
<div class="ttc" id="aclasstoolbox_1_1io_1_1kitti__odometry__pair__dataset__t_html"><div class="ttname"><a href="classtoolbox_1_1io_1_1kitti__odometry__pair__dataset__t.html">toolbox::io::kitti_odometry_pair_dataset_t</a></div><div class="ttdoc">KITTI Odometry frame pair dataset loader.</div><div class="ttdef"><b>Definition</b> kitti_odometry_pair_dataset.hpp:34</div></div>
<div class="ttc" id="aclasstoolbox_1_1io_1_1semantic__kitti__dataset__t_html"><div class="ttname"><a href="classtoolbox_1_1io_1_1semantic__kitti__dataset__t.html">toolbox::io::semantic_kitti_dataset_t</a></div><div class="ttdoc">Semantic KITTI dataset loader.</div><div class="ttdef"><b>Definition</b> semantic_kitti_dataset.hpp:48</div></div>
<div class="ttc" id="akitti__odometry__dataset_8hpp_html"><div class="ttname"><a href="kitti__odometry__dataset_8hpp.html">kitti_odometry_dataset.hpp</a></div></div>
<div class="ttc" id="anamespacetoolbox_1_1io_html"><div class="ttname"><a href="namespacetoolbox_1_1io.html">toolbox::io</a></div><div class="ttdoc">&lt; 用于列出目录下的文件/For listing files in a directory</div><div class="ttdef"><b>Definition</b> dataloader.hpp:15</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md173"></a>
3.3 性能基准测试</h2>
<div class="fragment"><div class="line"><span class="comment">// benchmark/kitti_loader_bench.cpp</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/benchmark/catch_benchmark.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kitti__odometry__dataset_8hpp.html">cpp-toolbox/io/dataloader/kitti_odometry_dataset.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;kitti_test_utils.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;KITTI Loader Performance&quot;</span>, <span class="stringliteral">&quot;[kitti][benchmark]&quot;</span>) {</div>
<div class="line">    kitti_test_env_t test_env(<span class="stringliteral">&quot;bench_seq&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 创建不同规模的测试数据</span></div>
<div class="line">    std::vector&lt;std::size_t&gt; frame_counts = {10, 50, 100};</div>
<div class="line">    std::vector&lt;std::size_t&gt; point_counts = {1000, 10000, 100000};</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> num_frames : frame_counts) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> num_points : point_counts) {</div>
<div class="line">            <span class="comment">// 准备测试数据</span></div>
<div class="line">            <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; num_frames; ++i) {</div>
<div class="line">                test_env.create_test_point_cloud(i, num_points);</div>
<div class="line">            }</div>
<div class="line">            test_env.create_test_poses(num_frames);</div>
<div class="line">            </div>
<div class="line">            std::string bench_name = <span class="stringliteral">&quot;Load &quot;</span> + std::to_string(num_frames) + </div>
<div class="line">                                   <span class="stringliteral">&quot; frames with &quot;</span> + std::to_string(num_points) + </div>
<div class="line">                                   <span class="stringliteral">&quot; points&quot;</span>;</div>
<div class="line">            </div>
<div class="line">            BENCHMARK(bench_name) {</div>
<div class="line">                <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">                </div>
<div class="line">                <span class="comment">// 加载所有帧</span></div>
<div class="line">                <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; dataset.size(); ++i) {</div>
<div class="line">                    <span class="keyword">auto</span> frame = dataset[i];</div>
<div class="line">                    <span class="keywordflow">return</span> frame-&gt;cloud-&gt;size();</div>
<div class="line">                }</div>
<div class="line">            };</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;缓存性能测试&quot;</span>) {</div>
<div class="line">        <span class="keyword">const</span> std::size_t num_frames = 100;</div>
<div class="line">        <span class="keyword">const</span> std::size_t num_points = 10000;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; num_frames; ++i) {</div>
<div class="line">            test_env.create_test_point_cloud(i, num_points);</div>
<div class="line">        }</div>
<div class="line">        test_env.create_test_poses(num_frames);</div>
<div class="line">        </div>
<div class="line">        BENCHMARK(<span class="stringliteral">&quot;无缓存随机访问&quot;</span>) {</div>
<div class="line">            <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">            dataset.set_cache_size(0);  <span class="comment">// 禁用缓存</span></div>
<div class="line">            </div>
<div class="line">            std::size_t total = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 10; ++i) {</div>
<div class="line">                <span class="keyword">auto</span> frame = dataset[i % num_frames];</div>
<div class="line">                total += frame-&gt;cloud-&gt;size();</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> total;</div>
<div class="line">        };</div>
<div class="line">        </div>
<div class="line">        BENCHMARK(<span class="stringliteral">&quot;有缓存随机访问&quot;</span>) {</div>
<div class="line">            <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a> dataset(test_env.get_sequence_path());</div>
<div class="line">            dataset.set_cache_size(10);  <span class="comment">// 缓存10帧</span></div>
<div class="line">            </div>
<div class="line">            std::size_t total = 0;</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 10; ++i) {</div>
<div class="line">                <span class="keyword">auto</span> frame = dataset[i % num_frames];</div>
<div class="line">                total += frame-&gt;cloud-&gt;size();</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> total;</div>
<div class="line">        };</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md174"></a>
3.4 集成测试（可选）</h2>
<p>创建一个可选的集成测试，只在有真实数据时运行：</p>
<div class="fragment"><div class="line"><span class="comment">// test/pcl/kitti_integration_test.cpp</span></div>
<div class="line"><span class="preprocessor">#ifdef KITTI_TEST_DATA_PATH</span></div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Real KITTI Data Integration Test&quot;</span>, <span class="stringliteral">&quot;[kitti][integration][.]&quot;</span>) {</div>
<div class="line">    <span class="comment">// 默认跳过，除非明确运行</span></div>
<div class="line">    <span class="keyword">const</span> std::string kitti_path = KITTI_TEST_DATA_PATH;</div>
<div class="line">    </div>
<div class="line">    SECTION(<span class="stringliteral">&quot;加载真实序列&quot;</span>) {</div>
<div class="line">        <a class="code hl_class" href="classtoolbox_1_1io_1_1kitti__odometry__dataset__t.html">kitti_odometry_dataset_t&lt;float&gt;</a> dataset(kitti_path + <span class="stringliteral">&quot;/sequences/00&quot;</span>);</div>
<div class="line">        </div>
<div class="line">        REQUIRE(dataset.size() &gt; 0);</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">auto</span> first_frame = dataset[0];</div>
<div class="line">        REQUIRE(first_frame.has_value());</div>
<div class="line">        REQUIRE(first_frame-&gt;cloud-&gt;size() &gt; 100000);  <span class="comment">// KITTI通常有10万+点</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 验证位姿维度</span></div>
<div class="line">        REQUIRE(first_frame-&gt;pose.rows() == 4);</div>
<div class="line">        REQUIRE(first_frame-&gt;pose.cols() == 4);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md175"></a>
3.5 测试数据最小化策略</h2>
<p>为了在CI/CD中运行测试，可以创建极小的参考数据：</p>
<div class="fragment"><div class="line"><span class="comment">// test/data/kitti_mini/</span></div>
<div class="line"><span class="keyword">namespace </span>kitti_test_data {</div>
<div class="line">    </div>
<div class="line"><span class="comment">// 嵌入最小测试数据</span></div>
<div class="line"><span class="keyword">struct </span>mini_kitti_data_t {</div>
<div class="line">    <span class="comment">// 10个点的二进制数据（40字节）</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> uint8_t mini_cloud_000000[] = {</div>
<div class="line">        <span class="comment">// x, y, z, intensity (每个4字节float)</span></div>
<div class="line">        0x00, 0x00, 0x80, 0x3F,  <span class="comment">// 1.0f</span></div>
<div class="line">        0x00, 0x00, 0x00, 0x40,  <span class="comment">// 2.0f</span></div>
<div class="line">        0x00, 0x00, 0x40, 0x40,  <span class="comment">// 3.0f</span></div>
<div class="line">        0x00, 0x00, 0x80, 0x3F,  <span class="comment">// 1.0f</span></div>
<div class="line">        <span class="comment">// ... 更多点</span></div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 对应的标签数据（10个uint32）</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> uint32_t mini_labels_000000[] = {</div>
<div class="line">        40, 40, 44, 48, 50, 70, 71, 72, 40, 44</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 一行位姿数据</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* mini_pose_line = </div>
<div class="line">        <span class="stringliteral">&quot;1.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 1.0 0.0&quot;</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 创建迷你测试环境</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> create_mini_dataset(<span class="keyword">const</span> std::string&amp; output_path) {</div>
<div class="line">        <span class="comment">// 创建目录结构</span></div>
<div class="line">        std::filesystem::create_directories(output_path + <span class="stringliteral">&quot;/velodyne&quot;</span>);</div>
<div class="line">        std::filesystem::create_directories(output_path + <span class="stringliteral">&quot;/labels&quot;</span>);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 写入迷你点云</span></div>
<div class="line">        std::ofstream cloud_file(output_path + <span class="stringliteral">&quot;/velodyne/000000.bin&quot;</span>, </div>
<div class="line">                                std::ios::binary);</div>
<div class="line">        cloud_file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(mini_cloud_000000), </div>
<div class="line">                        <span class="keyword">sizeof</span>(mini_cloud_000000));</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 写入标签</span></div>
<div class="line">        std::ofstream label_file(output_path + <span class="stringliteral">&quot;/labels/000000.label&quot;</span>, </div>
<div class="line">                                std::ios::binary);</div>
<div class="line">        label_file.write(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(mini_labels_000000), </div>
<div class="line">                        <span class="keyword">sizeof</span>(mini_labels_000000));</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// 写入位姿</span></div>
<div class="line">        std::ofstream pose_file(output_path + <span class="stringliteral">&quot;/../poses/00.txt&quot;</span>);</div>
<div class="line">        pose_file &lt;&lt; mini_pose_line &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace kitti_test_data</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md176"></a>
4. CMake测试配置</h1>
<div class="fragment"><div class="line"># test/CMakeLists.txt 添加</div>
<div class="line">option(KITTI_ENABLE_INTEGRATION_TESTS &quot;Enable KITTI integration tests&quot; OFF)</div>
<div class="line">set(KITTI_TEST_DATA_PATH &quot;&quot; CACHE PATH &quot;Path to KITTI test data&quot;)</div>
<div class="line"> </div>
<div class="line"># 编译测试辅助库</div>
<div class="line">add_library(kitti_test_utils INTERFACE)</div>
<div class="line">target_include_directories(kitti_test_utils INTERFACE </div>
<div class="line">    ${CMAKE_CURRENT_SOURCE_DIR}/pcl)</div>
<div class="line"> </div>
<div class="line"># 添加单元测试</div>
<div class="line">set(KITTI_TEST_FILES</div>
<div class="line">    pcl/kitti_dataset_test.cpp</div>
<div class="line">    pcl/kitti_utils_test.cpp</div>
<div class="line">    pcl/kitti_pose_reader_test.cpp</div>
<div class="line">    pcl/kitti_label_reader_test.cpp</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># 如果启用集成测试</div>
<div class="line">if(KITTI_ENABLE_INTEGRATION_TESTS AND KITTI_TEST_DATA_PATH)</div>
<div class="line">    list(APPEND KITTI_TEST_FILES pcl/kitti_integration_test.cpp)</div>
<div class="line">    target_compile_definitions(cpp-toolbox_test PRIVATE </div>
<div class="line">        KITTI_TEST_DATA_PATH=&quot;${KITTI_TEST_DATA_PATH}&quot;)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line"># 添加性能测试</div>
<div class="line">list(APPEND BENCHMARK_FILES</div>
<div class="line">    pcl/kitti_loader_bench.cpp</div>
<div class="line">)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md177"></a>
5. 持续集成配置</h1>
<div class="fragment"><div class="line"># .github/workflows/test.yml</div>
<div class="line">- name: Run KITTI unit tests</div>
<div class="line">  run: |</div>
<div class="line">    ./build/test/cpp-toolbox_test &quot;[kitti]&quot;</div>
<div class="line">    </div>
<div class="line">- name: Run KITTI benchmarks</div>
<div class="line">  run: |</div>
<div class="line">    ./build/benchmark/cpp-toolbox_benchmark &quot;[kitti]&quot; --benchmark-samples 10</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md178"></a>
6. 测试覆盖清单</h1>
<h2><a class="anchor" id="autotoc_md179"></a>
必须测试的功能</h2>
<ul>
<li>[x] 基本数据加载</li>
<li>[x] 空数据集处理</li>
<li>[x] 单帧/多帧访问</li>
<li>[x] 迭代器功能</li>
<li>[x] 缓存机制</li>
<li>[x] Skip参数</li>
<li>[x] 相对变换计算</li>
<li>[x] 标签读取</li>
<li>[x] 标签过滤</li>
<li>[x] 错误处理</li>
<li>[x] 文件格式验证</li>
<li>[x] 内存管理</li>
<li>[x] 线程安全（如果支持）</li>
</ul>
<h2><a class="anchor" id="autotoc_md180"></a>
边界情况</h2>
<ul>
<li>[x] 不存在的文件</li>
<li>[x] 损坏的文件</li>
<li>[x] 空文件</li>
<li>[x] 格式错误</li>
<li>[x] 索引越界</li>
<li>[x] 内存不足</li>
<li>[x] 权限问题</li>
</ul>
<h2><a class="anchor" id="autotoc_md181"></a>
性能测试</h2>
<ul>
<li>[x] 加载速度</li>
<li>[x] 缓存效率</li>
<li>[x] 内存使用</li>
<li>[x] 并发访问 </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
